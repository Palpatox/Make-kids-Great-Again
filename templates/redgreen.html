<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
        <title>Red Light Green Light</title>
        <style>
            #game {
                width: 100px;
                height: 100px;
                background-color: red;
            }
            #game.green {
                background-color: green;
            }

            #game.white {
                background-color: white;
            }
        </style>
    </head>
    <body>
        <button id="start">Start Game</button>
        <div id="game"></div>
        <div>Score: <span id="score">0</span></div>
        <div>Time: <span id="time">0</span></div>
        <script>
            let gameStarted = false;
            let shouldFreeze = false;
            let gameInterval;
            let score = 0;
            let timer = 0;


            //old values
            let old_az = 0;
            let old_ay = 0;
            let old_ax = 0;
            let old_gz = 0;
            let old_gy = 0;
            let old_gx = 0;

            const scoreDisplay = document.getElementById("score");
            const timeDisplay = document.getElementById("time");

            document.getElementById("start").addEventListener("click", function() {
                gameStarted = true;
                score = 0;
                timer = 0;
                startGame();
            });
            document.getElementById("game").classList.add("white");
            function startGame() {
                document.getElementById("game").classList.remove("white");
                gameInterval = setInterval(function() {
                    let digit = Math.floor((timer % 100) / 10);
                    shouldFreeze = digit % 2 === 1;
                    document.getElementById("game").classList.toggle("green", !shouldFreeze);
                    timer++;
                    timeDisplay.innerText = timer;
                    scoreDisplay.innerText = timer;
                }, 1000);
                scoreDisplay.innerText = score;
            }

            if (window.DeviceMotionEvent) {
                window.addEventListener('devicemotion', function(event) {
                    if (gameStarted && shouldFreeze) {
                        if (event.acceleration.x - old_ax > 1.5 || event.acceleration.y - old_ay > 1.5 || event.acceleration.z - old_az > 1.5 || event.rotationRate.alpha - old_gx > 25 || event.rotationRate.beta - old_gy > 25 || event.rotationRate.gamma - old_gz > 25) {
                            endGame("You moved during a red light!");
                        }
                    } else if (gameStarted && !shouldFreeze) {
                        //score++;
                        scoreDisplay.innerText = timer;
                        //shouldFreeze = true;
                        //setTimeout(function() {
                          //  document.getElementById("game").classList.remove("green");
                        //}, 2000);
                    }
                    old_ax = event.acceleration.x;
                    old_ay = event.acceleration.y;
                    old_az = event.acceleration.z;
                    old_gx = event.rotationRate.alpha;
                    old_gy = event.rotationRate.beta;
                    old_gz = event.rotationRate.gamma;
                });
            } else {
                alert("DeviceMotion is not supported on this device.");
            }

            function endGame(message) {
                clearInterval(gameInterval);
                gameStarted = false;
                shouldFreeze = false;
                document.getElementById("game").classList.remove("green");
                document.getElementById("game").classList.add("white");
                alert(message + " Final score: " + score + ". Time: " + timer + " seconds.");
            }
        </script>
</body>
</html>
